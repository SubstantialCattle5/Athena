generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model represents the application users
model User {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @db.VarChar(100)
  age       Int
  birthday  DateTime
  language  String   @default("english")
  location  String   @db.VarChar(255)
  gender    Gender
  email     String   @unique @db.VarChar(255)
  contact   String   @db.VarChar(20)
  picture   String   @db.VarChar(255)
  position  Position
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  blogs          Blog[]
  tasks          Task[]         @relation("UserTasks")
  issuedTasks    Task[]         @relation("IssuedTasks")
  sleepData      SleepData[]
  surveys        Survey[]
  medicalQueries MedicalQuery[]
  answers        Answer[]
  Quiz           Quiz[]

  @@index([email])
  @@index([name])
}

// Enum for gender
enum Gender {
  MALE
  FEMALE
  OTHER
}

// Enum for user positions
enum Position {
  SUPERVISOR
  EMPLOYEE
  USER
}

// Blog model represents blog posts authored by users
model Blog {
  id         String   @id @default(uuid()) @db.Uuid
  title      String   @db.VarChar(255)
  picture    String   @db.VarChar(255)
  content    String   @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  authorName String   @db.VarChar(100)
  user       User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String?  @db.Uuid
  region     String   @default("general")

  language String @default("english")

  @@index([userId])
  @@index([title])
}

// Task model represents tasks associated with users
model Task {
  id         String     @id @default(uuid()) @db.Uuid
  date       DateTime
  taskName   String     @db.VarChar(255)
  status     TaskStatus
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  user       User?      @relation(name: "UserTasks", fields: [userId], references: [id], onDelete: Cascade)
  userId     String?    @db.Uuid
  issuedBy   User?      @relation(name: "IssuedTasks", fields: [issuedById], references: [id], onDelete: SetNull)
  issuedById String?    @db.Uuid

  @@index([userId])
  @@index([issuedById])
}

// Enum for task status
enum TaskStatus {
  UPCOMING
  COMPLETED
  CANCELED
}

// SleepData model represents sleep data associated with users
model SleepData {
  id         String    @id @default(uuid()) @db.Uuid
  date       DateTime
  sleepStart DateTime
  sleepEnd   DateTime
  sleepType  SleepType
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String?   @db.Uuid

  @@index([userId])
}

// Enum for sleep type
enum SleepType {
  TODAY
  WEEKLY
  MONTHLY
}

// Survey model represents surveys created by users
model Survey {
  id          String     @id @default(uuid()) @db.Uuid
  topic       String     @default("question") @db.VarChar(255)
  description String     @db.Text
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  user        User?      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String?    @db.Uuid
  questions   Question[]

  @@index([userId])
  @@index([topic])
}

// Quiz model represents quizzes created by users
model Quiz {
  id        Int        @id @default(autoincrement())
  topic     String     @default("periods") @db.VarChar(255)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  questions Question[]
  userId    String?    @db.Uuid
  user      User?      @relation(fields: [userId], references: [id])

  @@index([topic])
}

// Question model represents questions in surveys or quizzes
model Question {
  id            Int          @id @default(autoincrement())
  text          String       @db.Text
  type          QuestionType
  correctAnswer String       @db.Text
  options       String[]     @default([""])
  answers       Answer[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  survey   Survey? @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  surveyId String? @db.Uuid

  Quiz   Quiz? @relation(fields: [quizId], references: [id])
  quizId Int?

  @@index([surveyId])
}

// Enum for question types
enum QuestionType {
  MULTIPLE_CHOICE
  OPEN_ENDED
  BOOLEAN
}

// Answer model represents answers to survey or quiz questions
model Answer {
  id         String    @id @default(uuid()) @db.Uuid
  response   String    @db.Text
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String?   @db.Uuid
  question   Question? @relation(fields: [questionId], references: [id], onDelete: Cascade)
  questionId Int?

  @@index([userId])
  @@index([questionId])
}

// MedicalQuery model represents medical queries made by users
model MedicalQuery {
  id        String      @id @default(uuid()) @db.Uuid
  query     String      @db.Text
  response  String      @db.Text
  status    QueryStatus
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User?       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String?     @db.Uuid

  @@index([userId])
}

// Enum for query status
enum QueryStatus {
  PENDING
  RESPONDED
  CLOSED
}
